(()=>{"use strict";var e={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__item_state_error",errorClass:"form__input-error_active"};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",i)}var o,r,c,a=function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup_opened"))&&n(e.target.closest(".popup"))},i=function(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))},u="a14ef751-2e04-445b-9224-d88ea9b735c0",s="https://nomoreparties.co/v1/plus-cohort-14/",l=function(e){return e.ok?e.json():Promise.reject(e.status)},d=function(e){return fetch(s+"cards/likes/"+e,{method:"PUT",headers:{authorization:u}})},m=function(e){return fetch(s+"cards/likes/"+e,{method:"DELETE",headers:{authorization:u}})},f=document.querySelector(".popup_type_card"),p=f.querySelector(".popup__image"),_=f.querySelector(".popup__image-caption"),v=document.querySelector(".photo-grid"),h=document.querySelector(".popup_type_check"),y=h.querySelector(".form__button"),S=document.querySelector("#card").content,q=function(e,n){var r=e.owner._id===n,c=e.likes.map((function(e){return e._id})).includes(n);v.prepend(function(e,n,r){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=S.cloneNode(!0),s=u.querySelector(".card__image"),v=u.querySelector(".card__like"),q=u.querySelector(".card__trash"),E=u.querySelector(".card__like-num");return u.querySelector(".card__title").textContent=e,s.alt=e,s.src=n,c>0?E.textContent=c:E.remove(),a&&v.classList.add("card__like_active"),v.addEventListener("click",(function(e){a?m(r).then(l).then((function(){e.target.classList.remove("card__like_active"),E.textContent="".concat(parseInt(E.textContent)-1)})).catch(console.log):d(r).then(l).then((function(){e.target.classList.add("card__like_active"),E.textContent="".concat(parseInt(E.textContent)+1)})).catch(console.log)})),i?q.addEventListener("click",(function(){o&&y.removeEventListener("click",o),o=C(r,s),y.addEventListener("click",o),t(h)})):q.remove(),s.addEventListener("click",(function(e){p.src=e.target.src,p.alt=e.target.alt,_.textContent=e.target.alt,t(f)})),u}(e.name,e.link,e._id,e.likes.length,c,r))},C=function(e,t){return function(o){var r;(r=e,fetch(s+"cards/"+r,{method:"DELETE",headers:{authorization:u}})).then(l).then((function(e){t.closest(".card").remove()})).catch(console.log).finally((function(){n(h)}))}},E=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},L=function(e,t,n){t.some((function(e){return!e.validity.valid}))?(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0)):(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled"))},g=function(e,t){var n=b(e,t);n.forEach((function(n){E(e,n,t)})),L(e.querySelector(t.submitButtonSelector),n,t)},b=function(e,t){return Array.from(e.querySelectorAll(t.inputSelector))},k=document.querySelector(".user-panel__add"),x=document.querySelector(".user-panel__edit-name"),A=document.querySelector(".popup_type_place"),T=document.querySelector(".popup_type_profile"),z=document.querySelector(".popup_type_avatar"),B=T.querySelector(".form__button"),j=A.querySelector(".form__button"),P=z.querySelector(".form__button"),w=document.querySelector(".user-panel__name"),N=document.querySelector(".user-panel__description"),O=document.querySelector(".user-panel__avatar-container"),D=document.querySelector(".user-panel__avatar"),J=T.querySelector(".form"),M=T.querySelector('.form__item[name="name"]'),H=T.querySelector('.form__item[name="description"]'),I=A.querySelector(".form"),V=I.querySelector('.form__item[name="title"]'),U=I.querySelector('.form__item[name="link"]');x.addEventListener("click",(function(n){M.value=w.textContent,H.value=N.textContent,g(J,e),t(T)})),k.addEventListener("click",(function(n){I.reset(),g(I,e),t(A)})),O.addEventListener("click",(function(n){document.forms.avatar.reset(),g(document.forms.avatar,e),t(z)})),T.querySelector(".form").addEventListener("submit",(function(e){var t,o;B.textContent="Сохранение...",(t=M.value,o=H.value,fetch(s+"users/me",{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})})).then(l).then((function(e){w.textContent=e.name,N.textContent=e.about})).catch(console.log).finally((function(){n(T),B.textContent="Сохранить"}))})),I.addEventListener("submit",(function(e){var t,o;j.textContent="Сохранение...",(t=V.value,o=U.value,fetch(s+"cards",{method:"POST",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:o})})).then(l).then((function(e){return q(e,r)})).catch(console.log).finally((function(){n(A),j.textContent="Создать"}))})),document.forms.avatar.addEventListener("submit",(function(e){P.textContent="Сохранение...",function(e){return fetch(s+"users/me/avatar",{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})})}(e.target.elements.link.value).then(l).then((function(e){D.src=e.avatar})).catch(console.log).finally((function(){n(z),P.textContent="Сохранить"}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",a)})),c=e,Array.from(document.querySelectorAll(c.formSelector)).forEach((function(e){var t=b(e,c),n=e.querySelector(c.submitButtonSelector);L(n,t,c),e.addEventListener("submit",(function(e){e.preventDefault()})),t.forEach((function(o){o.addEventListener("input",(function(r){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?E(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)})(e,o,c),L(n,t,c)}))}))})),fetch(s+"users/me",{headers:{authorization:u}}).then(l).then((function(e){w.textContent=e.name,N.textContent=e.about,D.src=e.avatar,r=e._id})).catch((function(e){console.log(e)})),fetch(s+"cards",{headers:{authorization:u}}).then(l).then((function(e){e.forEach((function(e){return q(e,r)}))})).catch(console.log)})();